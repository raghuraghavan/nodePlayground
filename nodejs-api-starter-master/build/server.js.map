{"version":3,"sources":["../src/server.js"],"names":["port","process","env","PORT","host","HOSTNAME","server","listen","console","log","handleExit","options","err","cleanup","actions","close","destroy","quit","forEach","i","length","exit","report","on","bind"],"mappings":";;;;;;;;;;AAUA,4B;AACA,0B;AACA,gC;AACA,kC,6IAbA;;;;;mLAQA,0CAOA,MAAMA,OAAOC,QAAQC,GAAR,CAAYC,IAAZ,IAAoB,IAAjC,CACA,MAAMC,OAAOH,QAAQC,GAAR,CAAYG,QAAZ,IAAwB,SAArC,C,CAEA;AACA,MAAMC,SAAS,cAAIC,MAAJ,CAAWP,IAAX,EAAiBI,IAAjB,EAAuB,MAAM;AAC1CI,UAAQC,GAAR,CAAa,6CAA4CL,IAAK,IAAGJ,IAAK,GAAtE;AACD,CAFc,CAAf;;AAIA;AACA,SAASU,UAAT,CAAoBC,OAApB,EAA6BC,GAA7B,EAAkC;AAChC,MAAID,QAAQE,OAAZ,EAAqB;AACnB,UAAMC,UAAU,CAACR,OAAOS,KAAR,EAAe,aAAGC,OAAlB,EAA2B,gBAAMC,IAAjC,CAAhB;AACAH,YAAQI,OAAR,CAAgB,CAACH,KAAD,EAAQI,CAAR,KAAc;AAC5B,UAAI;AACFJ,cAAM,MAAM;AACV,cAAII,MAAML,QAAQM,MAAR,GAAiB,CAA3B,EAA8BnB,QAAQoB,IAAR;AAC/B,SAFD;AAGD,OAJD,CAIE,OAAOT,GAAP,EAAY;AACZ,YAAIO,MAAML,QAAQM,MAAR,GAAiB,CAA3B,EAA8BnB,QAAQoB,IAAR;AAC/B;AACF,KARD;AASD;AACD,MAAIT,GAAJ,EAAS,iBAAOU,MAAP,CAAcV,GAAd;AACT,MAAID,QAAQU,IAAZ,EAAkBpB,QAAQoB,IAAR;AACnB;;AAEDpB,QAAQsB,EAAR,CAAW,MAAX,EAAmBb,WAAWc,IAAX,CAAgB,IAAhB,EAAsB,EAAEX,SAAS,IAAX,EAAtB,CAAnB;AACAZ,QAAQsB,EAAR,CAAW,QAAX,EAAqBb,WAAWc,IAAX,CAAgB,IAAhB,EAAsB,EAAEH,MAAM,IAAR,EAAtB,CAArB;AACApB,QAAQsB,EAAR,CAAW,SAAX,EAAsBb,WAAWc,IAAX,CAAgB,IAAhB,EAAsB,EAAEH,MAAM,IAAR,EAAtB,CAAtB;AACApB,QAAQsB,EAAR,CAAW,mBAAX,EAAgCb,WAAWc,IAAX,CAAgB,IAAhB,EAAsB,EAAEH,MAAM,IAAR,EAAtB,CAAhC","file":"server.js","sourcesContent":["/**\n * Copyright Â© 2016-present Kriasoft.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.txt file in the root directory of this source tree.\n */\n\n/* @flow */\n/* eslint-disable no-console, no-shadow */\n\nimport app from './app';\nimport db from './db';\nimport redis from './redis';\nimport errors from './errors';\n\nconst port = process.env.PORT || 8080;\nconst host = process.env.HOSTNAME || '0.0.0.0';\n\n// Launch Node.js server\nconst server = app.listen(port, host, () => {\n  console.log(`Node.js API server is listening on http://${host}:${port}/`);\n});\n\n// Shutdown Node.js app gracefully\nfunction handleExit(options, err) {\n  if (options.cleanup) {\n    const actions = [server.close, db.destroy, redis.quit];\n    actions.forEach((close, i) => {\n      try {\n        close(() => {\n          if (i === actions.length - 1) process.exit();\n        });\n      } catch (err) {\n        if (i === actions.length - 1) process.exit();\n      }\n    });\n  }\n  if (err) errors.report(err);\n  if (options.exit) process.exit();\n}\n\nprocess.on('exit', handleExit.bind(null, { cleanup: true }));\nprocess.on('SIGINT', handleExit.bind(null, { exit: true }));\nprocess.on('SIGTERM', handleExit.bind(null, { exit: true }));\nprocess.on('uncaughtException', handleExit.bind(null, { exit: true }));\n"]}